<div class="container">
  <div class="card">
    <header>
      <h1>C·∫≠p nh·∫≠t T√≤a nh√†</h1>
      <p>Ch·ªânh s·ª≠a th√¥ng tin c·∫•u tr√∫c v√† v·∫≠n h√†nh</p>
    </header>

    <div *ngIf="isLoading" class="text-center mt-4">
      <p class="text-primary">ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>

    <form [formGroup]="editForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading && currentBuilding" class="mt-4">
      
      <h5 class="mb-3 text-primary border-bottom pb-2">Th√¥ng tin chung</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold">D·ª± √°n</label>
          <input type="text" class="form-control" [value]="currentBuilding.projectId" readonly style="background-color: #f3f4f6;">
          <small class="text-muted" style="font-size: 0.75rem;">Kh√¥ng th·ªÉ thay ƒë·ªïi d·ª± √°n</small>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold">M√£ t√≤a nh√†</label>
          <input type="text" class="form-control" formControlName="buildingCode">
          <small class="text-muted" style="font-size: 0.75rem;">M√£ ƒë·ªãnh danh l√† duy nh·∫•t</small>
        </div>
        <div class="col-12 mb-3">
          <label class="form-label fw-bold">T√™n hi·ªÉn th·ªã <span class="text-danger">*</span></label>
          <input type="text" class="form-control" formControlName="name" placeholder="VD: T√≤a Park 1">
          
          <div *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched" class="text-danger small mt-1">
            T√™n t√≤a nh√† l√† b·∫Øt bu·ªôc.
          </div>
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">C·∫•u tr√∫c & K·ªπ thu·∫≠t</h5>
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">S·ªë t·∫ßng n·ªïi <span class="text-danger">*</span></label>
          <input type="number" class="form-control" formControlName="totalFloors" min="1">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">S·ªë t·∫ßng h·∫ßm <span class="text-danger">*</span></label>
          <input type="number" class="form-control" formControlName="totalBasements" min="0">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">T·ªïng di·ªán t√≠ch (m¬≤)</label>
          <input type="number" class="form-control" formControlName="totalArea">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Ng√†y b√†n giao</label>
          <input type="date" class="form-control" formControlName="handoverDate">
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">V·∫≠n h√†nh</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Hotline S·∫£nh L·ªÖ t√¢n</label>
          <input type="text" class="form-control" formControlName="receptionPhone" placeholder="VD: 024...">
        </div>
        
        <div class="col-12 mb-3">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="activeSwitch" formControlName="isActive" style="width: 1.2rem; height: 1.2rem;">
                <label class="form-check-label fw-bold cursor-pointer" for="activeSwitch" style="margin-left: 0.5rem;">
                    ƒêang ho·∫°t ƒë·ªông (Active)
                </label>
            </div>
        </div>

        <div class="col-12 mb-3">
          <label class="form-label">M√¥ t·∫£ / Ghi ch√∫</label>
          <textarea class="form-control" formControlName="description" rows="3"></textarea>
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">
        üìÖ C·∫•u h√¨nh H√≥a ƒë∆°n H√†ng th√°ng
      </h5>
      <div class="info-box mb-3">
        <div class="info-content">
          <div class="info-title">
            <strong>üí° C√°ch ho·∫°t ƒë·ªông:</strong>
          </div>
          <ul class="info-list">
            <li>
              H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o h√≥a ƒë∆°n h√†ng th√°ng cho t·∫•t c·∫£ cƒÉn h·ªô trong t√≤a nh√†
            </li>
            <li>
              <strong>Ng√†y k·∫øt th√∫c ch·ªët s·ªë:</strong> M·∫∑c ƒë·ªãnh = Ng√†y b·∫Øt ƒë·∫ßu + 2, nh∆∞ng c√≥ th·ªÉ ch·ªânh s·ª≠a t·ª± do
            </li>
            <li>
              <strong>Ng√†y t·∫°o h√≥a ƒë∆°n = Ng√†y k·∫øt th√∫c ch·ªët s·ªë + 1</strong>
            </li>
            <li>
              <strong>V√≠ d·ª• 1:</strong> B·∫Øt ƒë·∫ßu <strong>1</strong>, K·∫øt th√∫c <strong>3</strong> ‚Üí T·∫°o h√≥a ƒë∆°n ng√†y <strong>4</strong> h√†ng th√°ng
            </li>
            <li>
              <strong>V√≠ d·ª• 2:</strong> B·∫Øt ƒë·∫ßu <strong>31</strong>, K·∫øt th√∫c <strong>1</strong> (th√°ng sau) ‚Üí T·∫°o h√≥a ƒë∆°n ng√†y <strong>2</strong> h√†ng th√°ng
            </li>
            <li>
              <strong>K·ª≥ h√≥a ƒë∆°n:</strong> S·∫Ω l√† th√°ng tr∆∞·ªõc ƒë√≥ 
              (v√≠ d·ª•: t·∫°o v√†o ng√†y 6/2 th√¨ k·ª≥ h√≥a ƒë∆°n l√† th√°ng 1/2024)
            </li>
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Ng√†y b·∫Øt ƒë·∫ßu ch·ªët s·ªë <span class="text-danger">*</span>
            <span class="text-muted" style="font-size: 0.75rem; font-weight: normal;">(1-31)</span>
          </label>
          <input type="number" class="form-control" formControlName="readingWindowStart" min="1" max="31" placeholder="VD: 1">
          <div *ngIf="hasInvalidDayWarning.start" class="text-warning small mt-1" style="color: #f59e0b;">
            L∆∞u √Ω: Th√°ng hi·ªán t·∫°i ch·ªâ c√≥ {{ getDaysInCurrentMonth() }} ng√†y. N·∫øu ch·ªçn ng√†y {{ editForm.get('readingWindowStart')?.value }}, h·ªá th·ªëng s·∫Ω hi·ªÉu l√† ng√†y cu·ªëi c√πng c·ªßa th√°ng (ng√†y {{ getDaysInCurrentMonth() }}).
          </div>
          <div *ngIf="editForm.get('readingWindowStart')?.invalid && editForm.get('readingWindowStart')?.touched" class="text-danger small mt-1">
            Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i t·ª´ 1 ƒë·∫øn 31.
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Ng√†y k·∫øt th√∫c ch·ªët s·ªë <span class="text-danger">*</span>
            <span class="text-muted" style="font-size: 0.75rem; font-weight: normal;">(T·ª± ƒë·ªông = B·∫Øt ƒë·∫ßu + 2)</span>
          </label>
          <input type="number" class="form-control" formControlName="readingWindowEnd" readonly style="background-color: #f3f4f6; cursor: not-allowed;">
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <a routerLink="/admin/building/list" class="btn btn-secondary">Quay l·∫°i</a>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || editForm.invalid">
          {{ isSubmitting ? 'ƒêang c·∫≠p nh·∫≠t...' : 'L∆∞u Thay ƒê·ªïi' }}
        </button>
      </div>
    </form>
  </div>
</div>