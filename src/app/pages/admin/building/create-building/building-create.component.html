<div class="container">
  <div class="card">
    <header>
      <h1>Th√™m m·ªõi T√≤a nh√†</h1>
      <p>Nh·∫≠p th√¥ng tin c·∫•u tr√∫c v√† v·∫≠n h√†nh cho t√≤a nh√† m·ªõi</p>
    </header>

    <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>

    <form [formGroup]="createForm" (ngSubmit)="onSubmit()" class="mt-4">
      
      <h5 class="mb-3 text-primary border-bottom pb-2">Th√¥ng tin chung</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold">D·ª± √°n <span class="text-danger">*</span></label>
          <select class="form-control" formControlName="projectId">
            <option value="">-- Ch·ªçn D·ª± √°n --</option>
            <option *ngFor="let p of projects" [value]="p.projectId">{{ p.name }} ({{p.projectCode}})</option>
          </select>
          <small *ngIf="createForm.get('projectId')?.invalid && createForm.get('projectId')?.touched" class="text-danger">
            Vui l√≤ng ch·ªçn d·ª± √°n.
          </small>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold">M√£ t√≤a nh√† <span class="text-danger">*</span></label>
          <input type="text" class="form-control" formControlName="buildingCode" placeholder="VD: TOA_A (Ch·ªØ hoa, kh√¥ng d·∫•u)">
          <small class="text-muted">Ch·ªâ d√πng ch·ªØ hoa (A-Z), s·ªë (0-9) v√† g·∫°ch d∆∞·ªõi (_)</small>
          <div *ngIf="createForm.get('buildingCode')?.invalid && createForm.get('buildingCode')?.touched" class="text-danger small">
            M√£ kh√¥ng h·ª£p l·ªá.
          </div>
        </div>
        <div class="col-12 mb-3">
          <label class="form-label fw-bold">T√™n hi·ªÉn th·ªã <span class="text-danger">*</span></label>
          <input type="text" class="form-control" formControlName="name" placeholder="VD: T√≤a Park 1">
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">C·∫•u tr√∫c & K·ªπ thu·∫≠t</h5>
      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label">S·ªë t·∫ßng n·ªïi <span class="text-danger">*</span></label>
          <input type="number" class="form-control" formControlName="totalFloors" min="1">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">S·ªë t·∫ßng h·∫ßm <span class="text-danger">*</span></label>
          <input type="number" class="form-control" formControlName="totalBasements" min="0">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">T·ªïng di·ªán t√≠ch (m¬≤)</label>
          <input type="number" class="form-control" formControlName="totalArea">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Ng√†y b√†n giao</label>
          <input type="date" class="form-control" formControlName="handoverDate">
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">V·∫≠n h√†nh</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Hotline S·∫£nh L·ªÖ t√¢n</label>
          <input type="text" class="form-control" formControlName="receptionPhone" placeholder="VD: 024...">
        </div>
        <div class="col-12 mb-3">
          <label class="form-label">M√¥ t·∫£ / Ghi ch√∫</label>
          <textarea class="form-control" formControlName="description" rows="3"></textarea>
        </div>
      </div>

      <h5 class="mb-3 mt-4 text-primary border-bottom pb-2">
        üìÖ C·∫•u h√¨nh H√≥a ƒë∆°n H√†ng th√°ng
      </h5>
      <div class="info-box mb-3">
        <div class="info-content">
          <div class="info-title">
            <strong>üí° C√°ch ho·∫°t ƒë·ªông:</strong>
          </div>
          <ul class="info-list">
            <li>
              H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o h√≥a ƒë∆°n h√†ng th√°ng cho t·∫•t c·∫£ cƒÉn h·ªô trong t√≤a nh√†
            </li>
            <li>
              <strong>Ng√†y k·∫øt th√∫c ch·ªët s·ªë:</strong> M·∫∑c ƒë·ªãnh = Ng√†y b·∫Øt ƒë·∫ßu + 2, nh∆∞ng c√≥ th·ªÉ ch·ªânh s·ª≠a t·ª± do
            </li>
            <li>
              <strong>Ng√†y t·∫°o h√≥a ƒë∆°n = Ng√†y k·∫øt th√∫c ch·ªët s·ªë + 1</strong>
            </li>
            <li>
              <strong>V√≠ d·ª• 1:</strong> B·∫Øt ƒë·∫ßu <strong>1</strong>, K·∫øt th√∫c <strong>3</strong> ‚Üí T·∫°o h√≥a ƒë∆°n ng√†y <strong>4</strong> h√†ng th√°ng
            </li>
            <li>
              <strong>V√≠ d·ª• 2:</strong> B·∫Øt ƒë·∫ßu <strong>31</strong>, K·∫øt th√∫c <strong>1</strong> (th√°ng sau) ‚Üí T·∫°o h√≥a ƒë∆°n ng√†y <strong>2</strong> h√†ng th√°ng
            </li>
            <li>
              <strong>K·ª≥ h√≥a ƒë∆°n:</strong> S·∫Ω l√† th√°ng tr∆∞·ªõc ƒë√≥ 
              (v√≠ d·ª•: t·∫°o v√†o ng√†y 6/2 th√¨ k·ª≥ h√≥a ƒë∆°n l√† th√°ng 1/2024)
            </li>
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Ng√†y b·∫Øt ƒë·∫ßu ch·ªët s·ªë <span class="text-danger">*</span>
            <span class="text-muted" style="font-size: 0.75rem; font-weight: normal;">(1-31)</span>
          </label>
          <input type="number" class="form-control" formControlName="readingWindowStart" min="1" max="31" placeholder="VD: 1">
          <div *ngIf="hasInvalidDayWarning.start" class="text-warning small mt-1" style="color: #f59e0b;">
            L∆∞u √Ω: Th√°ng hi·ªán t·∫°i ch·ªâ c√≥ {{ getDaysInCurrentMonth() }} ng√†y. N·∫øu ch·ªçn ng√†y {{ createForm.get('readingWindowStart')?.value }}, h·ªá th·ªëng s·∫Ω hi·ªÉu l√† ng√†y cu·ªëi c√πng c·ªßa th√°ng (ng√†y {{ getDaysInCurrentMonth() }}).
          </div>
          <div *ngIf="createForm.get('readingWindowStart')?.invalid && createForm.get('readingWindowStart')?.touched" class="text-danger small mt-1">
            Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i t·ª´ 1 ƒë·∫øn 31.
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Ng√†y k·∫øt th√∫c ch·ªët s·ªë <span class="text-danger">*</span>
            <span class="text-muted" style="font-size: 0.75rem; font-weight: normal;">(T·ª± ƒë·ªông = B·∫Øt ƒë·∫ßu + 2)</span>
          </label>
          <input type="number" class="form-control" formControlName="readingWindowEnd" readonly style="background-color: #f3f4f6; cursor: not-allowed;">
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <a routerLink="/admin/building/list" class="btn btn-secondary">H·ªßy b·ªè</a>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
          {{ isSubmitting ? 'ƒêang l∆∞u...' : 'L∆∞u T√≤a Nh√†' }}
        </button>
      </div>
    </form>
  </div>
</div>