<div class="container">
  <div class="card">
    <header>
      <h1>Quản lý Tài sản</h1>
      <p>Danh sách tài sản với các thông tin chi tiết:</p>
    </header>

    <div class="toolbar">
      <div class="search-wrapper">
        <div class="search-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
              clip-rule="evenodd" />
          </svg>
        </div>
        <input type="text" class="search-input" placeholder="Tìm theo mã, tên tài sản..." [(ngModel)]="searchTerm"
          (input)="onSearchInput()" />
      </div>

      <div class="filters-right">
        <select class="filter-select" [(ngModel)]="filterBuildingId" (change)="onFilterChange()">
          <option value="all">Tất cả tòa nhà</option>
          @for (building of buildings(); track building.buildingId) {
          <option [value]="building.buildingId">
            @if (building.name) {
            {{ building.name }}
            } @else if (building.buildingCode) {
            (Mã: {{ building.buildingCode }})
            } @else {
            (Không có tên)
            }
          </option>
          }
        </select>
      </div>

      <div class="actions-right">
        <button class="btn-create" (click)="onAddAsset()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" style="width: 18px; height: 18px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Thêm mới
        </button>
      </div>
    </div>

    @if (isLoading()) {
    <div class="text-center" style="padding: 2rem;">
      <div class="spinner"></div>
      <p style="margin-top: 10px; color: #6b7280;">Đang tải dữ liệu...</p>
    </div>
    } @else if (error()) {
    <div class="alert alert-danger" style="margin-top: 1.5rem;">
      <strong>Lỗi!</strong> {{ error() }}
    </div>
    }

    @if (!isLoading() && !error()) {
    <div class="table-container">
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>
                <div class="sort-header-content">
                  <span>Tên Tài Sản</span>
                </div>
              </th>
              <th>
                <div class="sort-header-content">
                  <span>Tòa Nhà</span>
                </div>
              </th>

              <th class="sortable-header" (click)="onSort('quantity')">
                <div class="sort-header-content">
                  <span>Số Lượng</span>
                  <span class="sort-icon">{{ getSortIcon('quantity') }}</span>
                </div>
              </th>

              <th class="sortable-header" (click)="onSort('createdAt')">
                <div class="sort-header-content">
                  <span>Ngày tạo</span>
                  <span class="sort-icon">{{ getSortIcon('createdAt') }}</span>
                </div>
              </th>

              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            @for (asset of pagedAssets(); track asset.assetId) {
            <tr [class.deleting-row]="deletingAssetId() === asset.assetId">
              <td class="font-medium">{{ asset.info }}</td>
              <td>{{ asset.buildingName }}</td>
              <td>{{ asset.quantity }}</td>
              <td style="color: #6b7280;">
                @if (asset.createdAt) { {{ asset.createdAt | date: 'dd/MM/yyyy' }} } @else { - }
              </td>
              <td class="actions">
                @if (deletingAssetId() === asset.assetId) {
                <div class="confirm-delete-wrapper">
                  <span class="confirm-text">Xóa?</span>
                  <button class="btn-confirm-delete" (click)="onConfirmDelete(asset.assetId)">Có</button>
                  <button class="btn-cancel-delete" (click)="onCancelDelete()">Hủy</button>
                </div>
                } @else {
                <button class="action-edit-btn" (click)="onEdit(asset)">
                  <svg class="action-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z" />
                  </svg>
                  Sửa
                </button>

                <!-- <button class="action-delete-icon-btn" (click)="onAskDelete(asset)" title="Xóa">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.577 0c-.27-.041-.54-.081-.811-.118m15.06 0A51.34 51.34 0 0 1 12 5.25c-2.662 0-5.227.29-7.69.835m15.06 0c.27.041.54.081.811.118m0 0v1.171a1.71 1.71 0 0 1-1.64 1.71H4.772a1.71 1.71 0 0 1-1.64-1.71V5.79" />
                  </svg>
                </button> -->
                }
              </td>
            </tr>
            } @empty {
            <tr>
              <td colspan="5" class="no-results">Không tìm thấy tài sản nào phù hợp.</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="pagination" *ngIf="totalItems() > 0">
      <span class="page-info">
        Hiển thị {{ startIndex() + 1 }}–{{ endIndex() }} trên <span class="font-medium">{{ totalItems() }}</span>
      </span>
      <div class="pagination-buttons">
        <!-- <button class="pagination-btn" (click)="firstPage()" [disabled]="pageIndex() === 1">« Đầu</button> -->
        <button class="pagination-btn" (click)="prevPage()" [disabled]="pageIndex() === 1">‹ Trước</button>
        <button class="pagination-btn" (click)="nextPage()" [disabled]="pageIndex() === totalPages()">Sau ›</button>
        <!-- <button class="pagination-btn" (click)="lastPage()" [disabled]="pageIndex() === totalPages()">Cuối »</button> -->
      </div>
    </div>
    }
  </div>
</div>
