<div class="page-container">
  <h1>Thêm Tài sản mới</h1>

  <section class="card">
    <div class="card-header">
      <h2 class="card-title">Thông tin tài sản</h2>
    </div>

    <form class="card-body form-vert" [formGroup]="assetForm" (ngSubmit)="onSubmit()">

      <div class="form-field">
        <label for="buildingId">Tòa nhà <span class="req">*</span></label>

        <select id="buildingId" formControlName="buildingId">
          @if (buildingsLoading()) {
            <option [value]="null" disabled>Đang tải danh sách tòa nhà...</option>
          }
          @else if (buildingsError()) {
            <option [value]="null" disabled>Lỗi: {{ buildingsError() }}</option>
          }
          @else {
            <option [value]="null" disabled selected>-- Chọn tòa nhà --</option>
            @for (building of buildings(); track building.buildingId) {
              <option [value]="building.buildingId">{{ building.name }}</option>
            }
          }
        </select>

        @if (isInvalid('buildingId')) {
          <div class="field-error">Vui lòng chọn một tòa nhà.</div>
        }
      </div>

      <div class="form-field">
        <label for="info">Tên Tài sản <span class="req">*</span></label>
        <input
          id="info"
          type="text"
          formControlName="info"
          placeholder="Ví dụ: Bóng đèn, Bàn, Ghế..."
        />

        @if (isInvalid('info')) {
           @if (assetForm.get('info')?.hasError('required')) {
             <div class="field-error">Tên tài sản không được để trống.</div>
           }
           @if (assetForm.get('info')?.hasError('assetExists')) {
             <div class="field-error">Tài sản này đã tồn tại trong tòa nhà đã chọn. Vui lòng nhập tên khác.</div>
           }
        }
      </div>

      <div class="form-field">
        <label for="quantity">Số Lượng <span class="req">*</span></label>
        <input
          id="quantity"
          type="number"
          inputmode="numeric"
          step="1"
          min="0"
          max="999"
          formControlName="quantity"
          placeholder="0"
        />

        @if (isInvalid('quantity')) {
          @if (assetForm.get('quantity')?.hasError('required')) {
            <div class="field-error">Số lượng không được để trống.</div>
          }
          @if (assetForm.get('quantity')?.hasError('min')) {
            <div class="field-error">Số lượng phải ít nhất là 0.</div>
          }
          @if (assetForm.get('quantity')?.hasError('max')) {
            <div class="field-error">Số lượng tối đa là 999.</div>
          }
          @if (assetForm.get('quantity')?.hasError('pattern')) {
            <div class="field-error">Số lượng phải là một số nguyên.</div>
          }
        }
      </div>

      @if (errorMessage()) {
        <div class="alert alert-danger">
          {{ errorMessage() }}
        </div>
      }

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancel()">Hủy</button>
        <button type="submit" class="btn btn-primary" [disabled]="assetForm.invalid || isSubmitting() || assetForm.pending">
          @if (isSubmitting()) {
            Đang lưu...
          } @else {
            Lưu
          }
        </button>
      </div>

    </form>
  </section>
</div>
