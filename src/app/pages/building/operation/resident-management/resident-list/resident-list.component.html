<div class="container">
  <div class="card">
    <header>
      <h1>Quản lý Cư dân</h1>
      <p>Danh sách cư dân trong hệ thống:</p>
    </header>

    <div class="filter-container">
      <div class="search-wrapper">
        <div class="search-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
              clip-rule="evenodd" />
          </svg>
        </div>
        <input type="text" class="search-input" placeholder="Tìm theo tên, Mã căn hộ,..." [(ngModel)]="searchTerm"
          (input)="onSearchChange()" />
      </div>

      <div class="filter-wrapper">
        <select class="filter-select" [(ngModel)]="selectedOwnerStatus" (change)="onFilterChange()">
          <option [ngValue]="null">Tất cả các loại</option>
          <option [ngValue]="true">Có Sở hữu</option>
          <option [ngValue]="false">Không Sở hữu</option>
        </select>
      </div>
    </div>

    @if (isLoading) {
    <div class="text-center" style="padding: 2rem;">
      <p>Đang tải dữ liệu...</p>
    </div>
    } @else if (error && members.length === 0) {
    <div class="alert alert-danger" style="margin-top: 1.5rem;">
      {{ error }}
    </div>
    } @else {
    <div class="table-container">
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th class="sortable-header" (click)="toggleSort('name')">
                <div class="sort-header-content">
                  <span>Họ tên</span>
                  <span class="sort-icon">
                    @if (query.sortBy === 'name') {
                    @if (query.sortOrder === 'asc') {
                    <svg class="sort-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
                    </svg>
                    } @else {
                    <svg class="sort-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                    }
                    } @else {
                    <svg class="sort-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                    </svg>
                    }
                  </span>
                </div>
              </th>
              <th>Căn hộ</th>
              <th>Loại</th>
              <th>Trạng thái</th>
              <th>CCCD</th>
              <th>Số điện thoại</th>
              <th>Ngày sinh</th>
              <th>Hành động</th>
            </tr>
          </thead>

          <tbody>
            @for (member of members; track member.apartmentMemberId) {
            <tr>
              <td class="font-medium">{{ member.name }}</td>
              <td>
                {{ apartmentCodeMap[member.apartmentId] || member.apartmentId }}
              </td>
              <td>
                @if (member.headMemberId == null) {
                <span class="status-owner">Chủ Hộ</span>
                } @else {
                <span class="status-member">Nhân Khẩu</span>
                }
              </td>
              <td>{{ member.status }}</td>
              <td>{{ member.idNumber }}</td>
              <td>{{ member.phoneNumber }}</td>
              <td>
                {{ member.dateOfBirth ? (member.dateOfBirth | date: 'dd/MM/yyyy') : 'N/A' }}
              </td>
              <td class="actions">
                <a [routerLink]="['../resident-list/detail', member.apartmentMemberId]" class="action-view">
                  <svg class="action-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  Xem
                </a>
              </td>
            </tr>
            } @empty {
            <tr>
              <td colspan="8" class="no-results">Không tìm thấy cư dân nào phù hợp.</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <span class="page-info">
        Trang <span class="font-medium">{{ currentPage }}</span> / <span class="font-medium">{{ totalPages }}</span>
      </span>
      <div class="pagination-buttons">
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
          Trước
        </button>
        <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
          Tiếp
        </button>
      </div>
    </div>
    }
  </div>
</div>
