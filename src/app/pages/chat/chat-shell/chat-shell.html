<div class="chat-container">
    <div class="chat-list-column">
        <header class="chat-header">
            <h3>üí¨ H·ªôp th∆∞</h3>
        </header>
        <div class="interaction-list">
            <p *ngIf="interactionList.length === 0 && !isLoadingList" class="empty-state">
                Ch∆∞a c√≥ cu·ªôc h·ªôi tho·∫°i n√†o.
            </p>
            <p *ngIf="isLoadingList" class="empty-state">
                ƒêang t·∫£i danh s√°ch...
            </p>

            <div *ngFor="let interaction of interactionList" class="interaction-item"
                [class.active]="interaction.interactionId === selectedInteraction?.interactionId"
                (click)="selectInteraction(interaction)">

                <div class="avatar-sm"
                    [style.background-image]="'url(' + (interaction.partnerAvatarUrl || 'assets/default-avatar.png') + ')'">
                </div>

                <div class="interaction-info">
                    <div class="top-row">
                        <span class="partner-name">{{ interaction.partnerName }}</span>
                        <span class="timestamp">
                            {{ interaction.lastMessageSentAt | date:'shortTime' }}
                        </span>
                    </div>
                    <div class="bottom-row">
                        <p class="last-message">
                            {{ interaction.lastMessageContent || 'B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán...' }}
                        </p>

                        <span *ngIf="interaction.unreadCount > 0" class="unread-badge">
                            {{ interaction.unreadCount }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-window-column">
        <ng-container *ngIf="selectedInteraction; else noChatSelected">
            <header class="chat-header chat-header-details">
                <div class="partner-info">
                    <div class="avatar-sm partner-avatar"
                        [style.background-image]="'url(' + (selectedInteraction.partnerAvatarUrl || 'assets/default-avatar.png') + ')'">
                    </div>
                    <h4>{{ selectedInteraction.partnerName }}</h4>
                </div>
            </header>

            <div class="messages-container" #messagesContainer (scroll)="onScroll($event)">

                <div *ngIf="isLoadingMessages" class="loading-more">ƒêang t·∫£i tin nh·∫Øn c≈©...</div>
                <div *ngIf="!hasMoreMessages && !isLoadingMessages" class="end-of-chat">--- B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán ---
                </div>

                <div *ngFor="let message of messages" class="message-bubble-wrapper"
                    [class.self-sent]="message.senderId === currentUserId">

                    <div class="message-bubble">
                        <p class="message-content">{{ message.content }}</p>
                        <span class="message-time">{{ message.sentAt | date:'HH:mm' }}</span>
                    </div>
                </div>
            </div>

            <footer class="message-input-area">
                <input type="text" placeholder="Nh·∫≠p tin nh·∫Øn..." [(ngModel)]="newMessageContent"
                    (keyup.enter)="sendMessage(newMessageContent)" />
                <button (click)="sendMessage(newMessageContent)" [disabled]="!newMessageContent?.trim()">
                    <i class="fas fa-paper-plane"></i> G·ª≠i
                </button>
            </footer>
        </ng-container>

        <ng-template #noChatSelected>
            <div class="empty-chat-state">
                Ch·ªçn m·ªôt cu·ªôc h·ªôi tho·∫°i t·ª´ danh s√°ch ƒë·ªÉ b·∫Øt ƒë·∫ßu chat.
            </div>
        </ng-template>

    </div>
</div>