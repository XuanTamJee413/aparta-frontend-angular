<div class="auth-container">
  <div class="auth-box">
    <div class="auth-header">
      <div class="logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 2L19 4M7 4L5 2M5 2L2 5M5 2L5 8M19 4L22 5M19 4L19 8M2 5L8 5M22 5L16 5M8 5L8 9C8 11.2091 9.79086 13 12 13C14.2091 13 16 11.2091 16 9V5M8 5L16 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 13V22M12 22L8 18M12 22L16 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="title">{{ isFirstLogin() ? 'Đổi mật khẩu lần đầu' : 'Đặt lại mật khẩu' }}</h1>
      <p class="subtitle">{{ isFirstLogin() ? 'Đây là lần đầu bạn đăng nhập. Vui lòng đổi mật khẩu để bảo mật tài khoản.' : 'Nhập mật khẩu mới cho tài khoản của bạn' }}</p>
    </div>

    <div *ngIf="success()" class="success-box">
      <div class="success-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2 class="success-title">{{ isFirstLogin() ? 'Đổi mật khẩu thành công!' : 'Đặt lại mật khẩu thành công!' }}</h2>
      <p class="success-text">{{ isFirstLogin() ? 'Bạn sẽ được chuyển đến trang chính trong giây lát...' : 'Bạn sẽ được chuyển đến trang đăng nhập trong giây lát...' }}</p>
      <a *ngIf="!isFirstLogin()" routerLink="/auth/login" class="back-link">Đi đến đăng nhập ngay</a>
    </div>

    <form *ngIf="!success()" [formGroup]="form" (ngSubmit)="onSubmit()" class="auth-form">
      <div *ngIf="email()" class="email-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 6L12 13L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span><strong>Email:</strong> {{ email() }}</span>
      </div>

      <div class="form-group">
        <label for="newPassword" class="form-label">Mật khẩu mới</label>
        <div class="input-wrapper">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 12H16M12 8V16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input 
            type="password" 
            id="newPassword" 
            formControlName="newPassword" 
            class="form-input"
            placeholder="Tối thiểu 6 ký tự"
            [disabled]="submitting()"
            [class.input-error]="form.get('newPassword')?.invalid && form.get('newPassword')?.touched" />
        </div>
        <div class="error-message" *ngIf="form.get('newPassword')?.touched && form.get('newPassword')?.errors">
          <span *ngIf="form.get('newPassword')?.errors?.['required']">Vui lòng nhập mật khẩu mới</span>
          <span *ngIf="form.get('newPassword')?.errors?.['minlength']">Mật khẩu tối thiểu 6 ký tự</span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
        <div class="input-wrapper">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            class="form-input"
            placeholder="Nhập lại mật khẩu mới"
            [disabled]="submitting()"
            [class.input-error]="form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched" />
        </div>
        <div class="error-message" *ngIf="form.get('confirmPassword')?.touched && form.get('confirmPassword')?.errors">
          <span *ngIf="form.get('confirmPassword')?.errors?.['required']">Vui lòng xác nhận mật khẩu</span>
        </div>
        <div class="error-message" *ngIf="form.errors?.['passwordMismatch'] && (form.get('confirmPassword')?.touched || form.get('newPassword')?.touched)">
          Mật khẩu xác nhận không khớp
        </div>
      </div>

      <div class="error-alert" *ngIf="error()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 8V12M12 16H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>{{ error() }}</span>
      </div>

      <button type="submit" class="submit-btn" [disabled]="form.get('newPassword')?.invalid || form.get('confirmPassword')?.invalid || form.errors?.['passwordMismatch'] || submitting() || (!isFirstLogin() && (!token() || !email()))">
        <span *ngIf="!submitting()">Đặt lại mật khẩu</span>
        <span *ngIf="submitting()" class="loading">
          <span class="spinner"></span>
          Đang xử lý...
        </span>
      </button>

      <div class="form-footer">
        <a routerLink="/auth/login" class="back-link">Quay lại đăng nhập</a>
      </div>
    </form>
  </div>
</div>
